
Background
Water level monitoring is a critical function carried out by the Central Water Commission (CWC) to manage India‚Äôs rivers, reservoirs, and flood control infrastructure. Currently, river levels are recorded manually, with staff physically observing and recording the water levels. This process involves taking hourly readings, including during the night.

With the increasing frequency of climate-driven flood events and the importance of real-time hydrological data, there is a growing need to modernize the water level monitoring infrastructure. Leveraging GSM technology, which has widespread coverage even in rural and remote areas, offers a practical solution for remote, automated, and real-time data transmission.

Description
At present, water level data at CWC sites is captured hourly, mostly manually by reading the gauge posts. Most of the sites are located in remote areas. These hourly water levels are useful for predicting flood levels in rivers as well as inflows into reservoirs.

The challenge is to develop a low-cost, energy-efficient GSM-based portable hardware system that:
Transmits data in real-time to central servers or cloud platforms via GSM.
Functions autonomously in remote environments with minimal human intervention.

This system would help in continuous monitoring, enabling faster and more accurate responses to changing water conditions.

Expected solution
There is a need for a floating sensor-based automatic water level reading device.
A GSM/GPRS module (e.g., SIM800/900) should be used to transmit readings to a central server, cloud platform, or API endpoint.
The system should support periodic data transmission and emergency alerts.
A setup with battery backup is required to ensure continuous operation under field conditions.
The sensors should be compact robust and unaffected by submergence conditions.
The device should have a weatherproof and rugged casing suitable for outdoor installation.
A vandal-resistant design is necessary for use in public or remote areas.
SMS alerts should be sent to authorities indicating hourly water levels.
The system should include local data logging to store readings in case of GSM failure.



this is the project that we are trying to do
  (PLEASE ANALYSE THE IMAGE)
AT POINT Z YOU HAVE A BOY ANT DEVICE THT FLOATS ON WATER AD HAS A TRANSMITTER THT IS ALWAYS POINTING TOWARDS X (THUS ACTING LIKE A TANGENT)
AT POINT X YOU HAVE AN ANCHOR + RECEIVER SYSTEM

X TO Y IS THE RIVER LEVEL THT WE NEED TO MONITOR AND FIND OUT EXACTLY USING THE ANGLE BETWEEN C AND A
AND THE LENGTH A 



NOW THE PROBLEM IS HOW DO I KEEP THE TENSION BETWEEN THE X AND Z CONSTANT SO THT 
THE DISTANCE X AND Z IS PERFECTLY STRAINGT?
Corners (Vertices)
The corners are the points where the lines meet. In this diagram, they are labeled with letters on the outside:

x (bottom-left corner)
y (top-left corner)
z (top-right corner)
Edges (Sides)
The edges are the straight lines connecting the corners. They are labeled with letters placed next to the lines:

a (the diagonal line connecting corners x and z)
b (the top horizontal line connecting corners y and z)
c (the vertical line connecting corners x and y)
DO NOTE FOR THE X AND Z DISTANCE I AM USING A FISHING NET ROPE 
AND DO NOTE THT THE XY EDGE IS THE PERPENDICULAR FROM THE ANCHOR THUS ALLOWING US TO ACCURATELY CALCULATE THE ANGLE OF DEVIATION THUS FURHTER ALLOWING US TO FIND OUT THE LENGHT OF XY



Background
Water level monitoring is a critical function carried out by the Central Water Commission (CWC) to manage India‚Äôs rivers, reservoirs, and flood control infrastructure. Currently, river levels are recorded manually, with staff physically observing and recording the water levels. This process involves taking hourly readings, including during the night.

With the increasing frequency of climate-driven flood events and the importance of real-time hydrological data, there is a growing need to modernize the water level monitoring infrastructure. Leveraging GSM technology, which has widespread coverage even in rural and remote areas, offers a practical solution for remote, automated, and real-time data transmission.

Description
At present, water level data at CWC sites is captured hourly, mostly manually by reading the gauge posts. Most of the sites are located in remote areas. These hourly water levels are useful for predicting flood levels in rivers as well as inflows into reservoirs.

The challenge is to develop a low-cost, energy-efficient GSM-based portable hardware system that:
Transmits data in real-time to central servers or cloud platforms via GSM.
Functions autonomously in remote environments with minimal human intervention.

This system would help in continuous monitoring, enabling faster and more accurate responses to changing water conditions.

Expected solution
There is a need for a floating sensor-based automatic water level reading device.
A GSM/GPRS module (e.g., SIM800/900) should be used to transmit readings to a central server, cloud platform, or API endpoint.
The system should support periodic data transmission and emergency alerts.
A setup with battery backup is required to ensure continuous operation under field conditions.
The sensors should be compact robust and unaffected by submergence conditions.
The device should have a weatherproof and rugged casing suitable for outdoor installation.
A vandal-resistant design is necessary for use in public or remote areas.
SMS alerts should be sent to authorities indicating hourly water levels.
The system should include local data logging to store readings in case of GSM failure.



this is the project that we are trying to do
  (PLEASE ANALYSE THE IMAGE)
AT POINT Z YOU HAVE A BOY ANT DEVICE THT FLOATS ON WATER AD HAS A TRANSMITTER THT IS ALWAYS POINTING TOWARDS X (THUS ACTING LIKE A TANGENT)
AT POINT X YOU HAVE AN ANCHOR + RECEIVER SYSTEM

X TO Y IS THE RIVER LEVEL THT WE NEED TO MONITOR AND FIND OUT EXACTLY USING THE ANGLE BETWEEN C AND A
AND THE LENGTH A 



NOW THE PROBLEM IS HOW DO I KEEP THE TENSION BETWEEN THE X AND Z CONSTANT SO THT 
THE DISTANCE X AND Z IS PERFECTLY STRAINGT?
Corners (Vertices)
The corners are the points where the lines meet. In this diagram, they are labeled with letters on the outside:

x (bottom-left corner)
y (top-left corner)
z (top-right corner)
Edges (Sides)
The edges are the straight lines connecting the corners. They are labeled with letters placed next to the lines:

a (the diagonal line connecting corners x and z)
b (the top horizontal line connecting corners y and z)
c (the vertical line connecting corners x and y)
DO NOTE FOR THE X AND Z DISTANCE I AM USING A FISHING NET ROPE 
AND DO NOTE THT THE XY EDGE IS THE PERPENDICULAR FROM THE ANCHOR THUS ALLOWING US TO ACCURATELY CALCULATE THE ANGLE OF DEVIATION THUS FURHTER ALLOWING US TO FIND OUT THE LENGHT OF XY


NOW the problem is 
Imagine the depth being 400 cm from the surface of the water 
if i were to use this method then tht means tht the bouy will float away and deviate FAR OFF
from the original point

(since the river currents hit the bouy the bouy will keep on moving to the right more and more and more )


how can i limit this and calculate the exact water level?


































please analyse all of the data Ive sent :
Background Water level monitoring is a critical function carried out by the Central Water Commission (CWC) to manage India‚Äôs rivers, reservoirs, and flood control infrastructure. Currently, river levels are recorded manually, with staff physically observing and recording the water levels. This process involves taking hourly readings, including during the night.

With the increasing frequency of climate-driven flood events and the importance of real-time hydrological data, there is a growing need to modernize the water level monitoring infrastructure. Leveraging GSM technology, which has widespread coverage even in rural and remote areas, offers a practical solution for remote, automated, and real-time data transmission.

Description At present, water level data at CWC sites is captured hourly, mostly manually by reading the gauge posts. Most of the sites are located in remote areas. These hourly water levels are useful for predicting flood levels in rivers as well as inflows into reservoirs.

The challenge is to develop a low-cost, energy-efficient GSM-based portable hardware system that: Transmits data in real-time to central servers or cloud platforms via GSM. Functions autonomously in remote environments with minimal human intervention.

This system would help in continuous monitoring, enabling faster and more accurate responses to changing water conditions.

Expected solution There is a need for a floating sensor-based automatic water level reading device. A GSM/GPRS module (e.g., SIM800/900) should be used to transmit readings to a central server, cloud platform, or API endpoint. The system should support periodic data transmission and emergency alerts. A setup with battery backup is required to ensure continuous operation under field conditions. The sensors should be compact robust and unaffected by submergence conditions. The device should have a weatherproof and rugged casing suitable for outdoor installation. A vandal-resistant design is necessary for use in public or remote areas. SMS alerts should be sent to authorities indicating hourly water levels. The system should include local data logging to store readings in case of GSM failure.

this is the project that we are trying to do (PLEASE ANALYSE THE IMAGE) AT POINT Z YOU HAVE A BOY ANT DEVICE THT FLOATS ON WATER AD HAS A TRANSMITTER THT IS ALWAYS POINTING TOWARDS X (THUS ACTING LIKE A TANGENT) AT POINT X YOU HAVE AN ANCHOR + RECEIVER SYSTEM

X TO Y IS THE RIVER LEVEL THT WE NEED TO MONITOR AND FIND OUT EXACTLY USING THE ANGLE BETWEEN C AND A AND THE LENGTH A

x (bottom-left corner) y (top-left corner) z (top-right corner) Edges (Sides) The edges are the straight lines connecting the corners. They are labeled with letters placed next to the lines:

a (the diagonal line connecting corners x and z) b (the top horizontal line connecting corners y and z) c (the vertical line connecting corners x and y) DO NOTE FOR THE X AND Z DISTANCE I AM USING A FISHING NET ROPE AND DO NOTE THT THE XY EDGE IS THE PERPENDICULAR FROM THE ANCHOR THUS ALLOWING US TO ACCURATELY CALCULATE THE ANGLE OF DEVIATION THUS FURTHER ALLOWING US TO FIND OUT THE LENGTH OF XY

(since the river currents hit the buoy the buoy will keep on moving to the right more and more and more )



additional info related to features :
# üìã **VARUNA SYSTEM - COMPLETE FEATURE LIST**

---

## **1. OPERATING MODES (As Defined)**

### **1.1 NORMAL MODE**
| Feature | Description |
|---------|-------------|
| **Sampling Interval** | Every 60 minutes |
| **Sensors Active** | All 3 sensors (MPU-6050, HC-SR04, MS5837) |
| **Data Transmission** | GPRS to cloud server (JSON over HTTPS) |
| **Power Consumption** | ~59.8 Wh/day |
| **GPS** | Enabled for location tagging |
| **LED Indicators** | Active (Green = OK, Yellow = Warning, Red = Error) |
| **Sleep Duration** | 55 minutes between readings |

### **1.2 FLOOD MODE**
| Feature | Description |
|---------|-------------|
| **Trigger Condition** | Water rise >5cm in 15 minutes |
| **Sampling Interval** | Every 5 minutes |
| **Data Transmission** | GPRS every 5 minutes + SMS alerts |
| **Power Consumption** | ~76.3 Wh/day |
| **Alert Actions** | Multi-tier SMS, Voice calls if unacknowledged |
| **Exit Condition** | Water stable for >2 hours |
| **LED Indicator** | Rapid blinking |

### **1.3 LOW POWER MODE**
| Feature | Description |
|---------|-------------|
| **Trigger Condition** | Battery <20% |
| **Sensors Active** | Primary sensor only (MPU-6050) |
| **Sampling Interval** | Every 6 hours |
| **Data Transmission** | SMS only (no GPRS) |
| **GPS** | Disabled |
| **LED Indicators** | Disabled |
| **Exit Condition** | Battery >50% AND solar active |

### **1.4 MAINTENANCE MODE**
| Feature | Description |
|---------|-------------|
| **Trigger** | SMS command "MODE MAINTENANCE" |
| **Operation** | Suspends normal operations |
| **Access** | Full terminal access via web interface |
| **Exit** | SMS command "MODE NORMAL" or via terminal |
| **Use Case** | Physical maintenance, firmware updates, calibration |

---

## **2. SENSOR FEATURES**

### **2.1 Primary Sensor - MPU-6050 (IMU)**
| Feature | Description |
|---------|-------------|
| **Measurement Type** | Pitch angle of floating arm |
| **Interface** | I2C (address 0x68) |
| **Sampling** | 10 samples per reading, outlier rejection (discard 2 highest, 2 lowest) |
| **Accuracy** | ¬±0.5¬∞ pitch angle |
| **Water Level Conversion** | L = 1.5m √ó sin(pitch) |
| **Sleep Mode** | Enabled between readings |
| **Fault Detection** | 3 consecutive I2C failures = FAULT |
| **Physical Obstruction Alert** | Pitch >95¬∞ or <-5¬∞ |
| **Wave Interference Detection** | Variance >5¬∞ between samples |
| **Weight in Consensus** | 50% |

### **2.2 Secondary Sensor - HC-SR04 (Ultrasonic)**
| Feature | Description |
|---------|-------------|
| **Measurement Type** | Distance to water surface |
| **Interface** | GPIO (Trigger: GPIO17, Echo: GPIO18) |
| **Range** | 2cm - 400cm |
| **Sampling** | 5 samples, average calculation |
| **Water Level Conversion** | L = Post Height - Measured Distance |
| **Weight in Consensus** | 30% |

### **2.3 Tertiary Sensor - MS5837 (Pressure)**
| Feature | Description |
|---------|-------------|
| **Measurement Type** | Water pressure/depth |
| **Interface** | I2C (address 0x76) |
| **Max Depth** | 30 meters |
| **Waterproof** | Yes (designed for submersion) |
| **Use Case** | Deep water backup measurement |
| **Weight in Consensus** | 20% |

### **2.4 Multi-Sensor Fusion**
| Feature | Description |
|---------|-------------|
| **Consensus Algorithm** | Weighted average (MPU: 50%, US: 30%, PS: 20%) |
| **Agreement Threshold** | All sensors within 5% |
| **Fault Tolerance** | If 1 sensor fails, use remaining 2 |
| **If 2 sensors fail** | Use MPU-6050 only, send FAULT alert |

---

## **3. ALERT & NOTIFICATION FEATURES**

### **3.1 Alert Severity Levels**
| Level | Condition | Action |
|-------|-----------|--------|
| **INFO** | Normal readings | Log to database only |
| **WARNING** | Water approaching warning level | SMS to District Office |
| **DANGER** | Water exceeds danger level | Multi-tier alert cascade |

### **3.2 Three-Tier Alert Escalation**
| Tier | Recipients | Timeout | If No ACK |
|------|-----------|---------|-----------|
| **TIER 1** | District CWC Office (3 numbers) | 10 minutes | Escalate to Tier 2 |
| **TIER 2** | Local Panchayat + District Collector | 15 minutes | Escalate to Tier 3 |
| **TIER 3** | State Control Room + NDRF | Continuous | Voice calls initiated |

### **3.3 Communication Priority**
| Priority | Method | Use Case |
|----------|--------|----------|
| **1** | GPRS/LTE ‚Üí Cloud API | Real-time data (JSON) |
| **2** | SMS ‚Üí Alert Numbers | Critical alerts + fallback |
| **3** | Voice Call ‚Üí NDRF | Emergency when SMS unacknowledged |
| **4** | FTP ‚Üí Server | Daily bulk upload of logs |

### **3.4 Alert Message Format (SMS)**
```
[CWC-ALERT]
Site: CWC-RJ-001
Level: 187cm (DANGER)
Rise: +12cm/15min
Time: 15-Jan 14:30
Loc: 26.91N 75.78E
Batt: 45%
```

### **3.5 Acknowledgment System**
| Feature | Description |
|---------|-------------|
| **ACK Format** | Reply "ACK-CWC-RJ-001" to acknowledge |
| **Auto-Cancel** | Stops escalation if ACK received |
| **Logging** | Records officer name + timestamp |
| **All Clear** | Sends "ALL CLEAR" when water stabilizes >2 hours |

---

## **4. POWER MANAGEMENT FEATURES**

### **4.1 Hybrid Energy Harvesting**
| Source | Capacity | Conditions |
|--------|----------|------------|
| **Solar Panel** | 20W @ 18V | Daytime, clear weather |
| **Wind Turbine** | 10W @ 12V | Wind >2m/s (cut-in speed) |
| **Combined** | 30W peak | Monsoon resilience |

### **4.2 Battery System**
| Feature | Specification |
|---------|---------------|
| **Type** | LiFePO4 (Lithium Iron Phosphate) |
| **Capacity** | 12V 20Ah (240Wh) |
| **Cycle Life** | 3000+ cycles |
| **Operating Temp** | -20¬∞C to 60¬∞C |
| **Built-in BMS** | Overcharge, deep discharge, reverse polarity protection |

### **4.3 Power Autonomy**
| Mode | Daily Consumption | Autonomy (No Charging) |
|------|-------------------|------------------------|
| **Normal** | 59.8 Wh | 4 days |
| **Flood** | 76.3 Wh | 3.1 days |
| **Low Power** | ~30 Wh | 8 days |

---

## **5. COMMUNICATION FEATURES**

### **5.1 SIM7600G-H Module Capabilities**
| Feature | Specification |
|---------|---------------|
| **Networks** | 4G LTE, 3G, 2G (automatic fallback) |
| **SMS** | Send/Receive text messages |
| **GPRS** | HTTP/HTTPS data transmission |
| **GPS** | Integrated GPS/GLONASS/BeiDou |
| **Voice** | Outgoing voice calls (pre-recorded audio) |

### **5.2 Offline Data Handling**
| Feature | Description |
|---------|-------------|
| **Local Queue** | Store up to 500 records in CSV |
| **Retry Interval** | Every 15 minutes |
| **Compression** | Archive to USB when queue full |
| **Auto-Upload** | Upload queued data when network restored |
| **Data Preservation** | 7+ days of offline storage |

---

## **6. SMS COMMAND FEATURES (Remote Control)**

### **6.1 Supported Commands**
| Command | Example | Description |
|---------|---------|-------------|
| `STATUS` | STATUS | Get current device status |
| `SET THRESHOLD` | SET THRESHOLD 150 | Set danger level to 150cm |
| `LOGS LAST` | LOGS LAST 5 | Get last 5 readings via SMS |
| `RESET` | RESET | Reboot device |
| `MODE` | MODE FLOOD | Change operating mode |
| `CALIBRATE` | CALIBRATE | Recalibrate sensors (20 readings) |
| `HELP` | HELP | List all commands |

### **6.2 Security**
| Feature | Description |
|---------|-------------|
| **Authorized Numbers** | Only whitelisted numbers can send commands |
| **Rejection Response** | "UNAUTHORIZED" SMS to unknown senders |
| **Command Logging** | All commands logged with timestamp |

### **6.3 Status Response Format**
```
Device ID: CWC-RJ-001
Level: 87cm
Battery: 78%
Mode: NORMAL
Signal: -67dBm
Uptime: 342 hours
```

---

## **7. WEB TERMINAL INTERFACE (NEW FEATURE)**

### **7.1 Overview**
| Feature | Description |
|---------|-------------|
| **Access Point** | Dashboard ‚Üí Device ‚Üí Terminal Tab |
| **Connection** | Secure WebSocket over HTTPS |
| **Shell** | Full Bash shell access to Raspberry Pi |
| **Authentication** | Role-based (Admin only) |

### **7.2 Terminal Capabilities**
| Capability | Description |
|------------|-------------|
| **Full Linux Commands** | Execute any bash command |
| **File System Access** | Navigate, edit, create, delete files |
| **Firmware Updates** | Modify Python scripts directly |
| **Configuration Changes** | Edit `/etc/varuna/config.json` |
| **Service Control** | `systemctl start/stop/restart varuna` |
| **Log Viewing** | `tail -f /var/log/varuna/sensor.log` |
| **Package Management** | `apt update`, `apt install` |
| **Network Diagnostics** | `ping`, `ifconfig`, `curl` |

### **7.3 Common Terminal Operations**

#### **View Real-Time Logs**
```bash
tail -f /var/log/varuna/sensor.log
```

#### **Edit Configuration**
```bash
nano /etc/varuna/config.json
```

#### **Update Firmware**
```bash
cd /opt/varuna
git pull origin main
systemctl restart varuna
```

#### **Check Sensor Status**
```bash
i2cdetect -y 1
```

#### **Test SMS Sending**
```bash
python3 /opt/varuna/tools/send_test_sms.py +919876543210 "Test message"
```

#### **Manual Sensor Reading**
```bash
python3 /opt/varuna/tools/read_sensors.py
```

#### **Restart Services**
```bash
systemctl restart varuna-monitor
systemctl restart varuna-comm
```

#### **Check System Resources**
```bash
htop
df -h
free -m
```

#### **Update Threshold via CLI**
```bash
varuna-cli set-threshold 150
```

#### **Force Data Transmission**
```bash
varuna-cli force-transmit
```

### **7.4 Terminal Security Features**
| Feature | Description |
|---------|-------------|
| **Role Restriction** | Admin users only |
| **Session Timeout** | Auto-disconnect after 15 min inactivity |
| **Audit Logging** | All commands logged with user + timestamp |
| **IP Whitelisting** | Optional restriction to known IPs |
| **Two-Factor Auth** | Optional 2FA for terminal access |
| **Read-Only Mode** | Optional mode for viewing without changes |

### **7.5 Terminal Architecture**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Web Browser   ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ   Web Server    ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  Raspberry Pi   ‚îÇ
‚îÇ   (Dashboard)   ‚îÇ      ‚îÇ   (Node.js)     ‚îÇ      ‚îÇ  (SSH Daemon)   ‚îÇ
‚îÇ                 ‚îÇ      ‚îÇ                 ‚îÇ      ‚îÇ                 ‚îÇ
‚îÇ  Terminal UI    ‚îÇ WSS  ‚îÇ  WebSocket      ‚îÇ SSH  ‚îÇ  Bash Shell     ‚îÇ
‚îÇ  (xterm.js)     ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  Proxy          ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  /bin/bash      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **7.6 File Structure Access**
```
/opt/varuna/
‚îú‚îÄ‚îÄ main.py                 # Main monitoring service
‚îú‚îÄ‚îÄ sensors/
‚îÇ   ‚îú‚îÄ‚îÄ mpu6050.py          # IMU driver
‚îÇ   ‚îú‚îÄ‚îÄ hcsr04.py           # Ultrasonic driver
‚îÇ   ‚îî‚îÄ‚îÄ ms5837.py           # Pressure sensor driver
‚îú‚îÄ‚îÄ communication/
‚îÇ   ‚îú‚îÄ‚îÄ gsm.py              # SIM7600G control
‚îÇ   ‚îú‚îÄ‚îÄ sms.py              # SMS handling
‚îÇ   ‚îî‚îÄ‚îÄ gprs.py             # GPRS transmission
‚îú‚îÄ‚îÄ power/
‚îÇ   ‚îî‚îÄ‚îÄ manager.py          # Power state management
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ config.json         # Device configuration
‚îú‚îÄ‚îÄ logs/
‚îÇ   ‚îú‚îÄ‚îÄ sensor.log          # Sensor readings
‚îÇ   ‚îú‚îÄ‚îÄ comm.log            # Communication logs
‚îÇ   ‚îî‚îÄ‚îÄ system.log          # System events
‚îî‚îÄ‚îÄ tools/
    ‚îú‚îÄ‚îÄ calibrate.py        # Calibration utility
    ‚îú‚îÄ‚îÄ send_test_sms.py    # SMS testing
    ‚îî‚îÄ‚îÄ read_sensors.py     # Manual sensor read
```

### **7.7 Firmware Update via Terminal**
| Method | Commands |
|--------|----------|
| **Git Pull** | `cd /opt/varuna && git pull origin main && systemctl restart varuna` |
| **Manual Upload** | Use `scp` or web file upload, then restart service |
| **Package Update** | `apt update && apt upgrade -y` |
| **Python Packages** | `pip3 install --upgrade smbus2 pyserial requests` |

---

## **8. DATA MANAGEMENT FEATURES**

### **8.1 Local Storage**
| Storage | Capacity | Purpose |
|---------|----------|---------|
| **MicroSD Card** | 32GB | OS (8GB) + Logs (20GB) + Buffer (4GB) |
| **USB Flash Drive** | 16GB | Emergency backup, archives |

### **8.2 Data Logging Format (CSV)**
```csv
timestamp,water_level_cm,mpu_pitch,mpu_level,us_distance,us_level,ps_pressure,ps_level,battery_pct,gsm_signal,mode
2024-01-15T14:30:00Z,87.6,32.5,87.3,112.7,87.3,1023.4,88.1,78,-67,NORMAL
```

### **8.3 Cloud Data Payload (JSON)**
```json
{
  "device_id": "CWC-RJ-001",
  "timestamp": "2024-01-15T14:30:00Z",
  "location": {
    "latitude": 26.9124,
    "longitude": 75.7873
  },
  "sensors": {
    "mpu6050": {"pitch_angle": 32.5, "water_level_cm": 87.3, "status": "OK"},
    "hcsr04": {"distance_cm": 112.7, "water_level_cm": 87.3, "status": "OK"},
    "ms5837": {"pressure_mbar": 1023.4, "water_level_cm": 88.1, "status": "OK"}
  },
  "consensus_level_cm": 87.6,
  "rate_of_change_cm_per_hour": 2.3,
  "power": {
    "battery_voltage": 12.4,
    "battery_percentage": 78,
    "solar_current_ma": 450,
    "wind_current_ma": 120
  },
  "system": {
    "mode": "NORMAL",
    "gsm_signal_strength": -67,
    "uptime_hours": 342
  }
}
```

---

## **9. SECURITY FEATURES**

### **9.1 Device Security**
| Feature | Description |
|---------|-------------|
| **SMS Whitelist** | Only authorized numbers can send commands |
| **Device Token** | SHA-256 signed authentication for API |
| **HTTPS/TLS** | TLS 1.2+ for all cloud communication |
| **Tamper Detection** | Enclosure open sensor triggers alert |

### **9.2 Data Security**
| Feature | Description |
|---------|-------------|
| **Payload Signing** | HMAC-SHA256 signature on all transmissions |
| **Timestamp Validation** | Server rejects data >5 minutes old |
| **Local Encryption** | AES-128 for stored logs (optional) |
| **GPS Geofencing** | Validate location within 100m of registered site |

### **9.3 Web Terminal Security**
| Feature | Description |
|---------|-------------|
| **Admin Only** | Role-based access control |
| **Session Timeout** | 15 minutes inactivity |
| **Command Audit Log** | Every command logged |
| **Optional 2FA** | Two-factor authentication |

---

## **10. SELF-DIAGNOSTIC FEATURES**

### **10.1 Automatic Health Checks**
| Check | Frequency | Action on Failure |
|-------|-----------|-------------------|
| **I2C Sensor Scan** | Every reading | Log error, use redundant sensors |
| **Battery Voltage** | Every 15 min | Switch to LOW POWER mode if <20% |
| **GSM Signal** | Every reading | Fallback to SMS if weak signal |
| **GPS Fix** | On boot | Continue without GPS if fails |
| **RTC Sync** | On boot | Use GSM network time if RTC fails |

### **10.2 Fault Notifications (SMS)**
| Fault | Message |
|-------|---------|
| **Sensor Failure** | "SENSOR FAULT: [sensor_name] not responding" |
| **Battery Critical** | "BATTERY CRITICAL: X% - Entering low power mode" |
| **Physical Obstruction** | "POSSIBLE OBSTRUCTION: Pitch angle out of range" |
| **Enclosure Tamper** | "SECURITY ALERT: Enclosure opened" |
| **Diagnostic on Boot** | "Missing sensors: [list]" |

---

## **11. CALIBRATION FEATURES**

### **11.1 Automatic Calibration (On Boot)**
| Step | Action |
|------|--------|
| 1 | Take 10 baseline readings |
| 2 | Calculate average as zero point |
| 3 | Store in `/etc/varuna/mpu_calibration.json` |

### **11.2 Remote Calibration (SMS)**
| Command | Action |
|---------|--------|
| `CALIBRATE` | Take 20 readings, recalculate zero point |
| **Duration** | ~3 minutes |
| **Response** | "CALIBRATION COMPLETE" |

### **11.3 Terminal Calibration**
```bash
# Via web terminal
python3 /opt/varuna/tools/calibrate.py --samples 50 --save
```

---

## **12. BOOT & INITIALIZATION**

### **12.1 Startup Sequence**
| Step | Action | Failure Handling |
|------|--------|------------------|
| 1 | Boot Raspberry Pi | Flash RED LED 3x, halt |
| 2 | Load `/etc/varuna/config.json` | Use defaults if corrupt |
| 3 | Initialize DS3231 RTC | Use GSM network time |
| 4 | Scan I2C bus for sensors | Log missing, continue if MPU OK |
| 5 | Initialize SIM7600G | Retry 3x, set OFFLINE flag |
| 6 | Check network registration | Wait 30s, retry 5x |
| 7 | Get GPS fix | Continue without if fails |
| 8 | Send boot SMS | "Varuna Device XXX Online" |
| 9 | Calibrate sensors | 10 baseline readings |
| 10 | Check battery level | Enter appropriate mode |

### **12.2 Boot Notification SMS**
```
Varuna Device CWC-RJ-001 Online
Location: 26.91N, 75.78E
Battery: 78%
Firmware: v1.0.3
```

---

## **13. ENVIRONMENTAL SPECIFICATIONS**

| Feature | Rating |
|---------|--------|
| **Enclosure** | IP67 (dust-tight, waterproof 1m for 30 min) |
| **Operating Temp** | -10¬∞C to 55¬∞C |
| **Storage Temp** | -20¬∞C to 60¬∞C |
| **UV Resistance** | Polycarbonate enclosure |
| **Corrosion Resistance** | Marine-grade aluminum, stainless steel |
| **Float Material** | Closed-cell EVA foam (unsinkable) |

---

## **14. SUMMARY - ALL FEATURES**

| Category | Count | Key Features |
|----------|-------|--------------|
| **Operating Modes** | 4 | Normal, Flood, Low Power, Maintenance |
| **Sensors** | 3 + fusion | MPU-6050, HC-SR04, MS5837, Weighted consensus |
| **Alert Levels** | 3 | INFO, WARNING, DANGER |
| **Alert Tiers** | 3 | District ‚Üí Panchayat ‚Üí State/NDRF |
| **Communication** | 4 channels | GPRS, SMS, Voice, FTP |
| **SMS Commands** | 7 | STATUS, SET, LOGS, RESET, MODE, CALIBRATE, HELP |
| **Power Sources** | 2 | Solar (20W), Wind (10W) |
| **Web Terminal** | Full access | Bash shell, firmware updates, configuration |
| **Security Features** | 8+ | Whitelist, tokens, HTTPS, audit logs, 2FA |
| **Self-Diagnostics** | 5 checks | Sensors, battery, GSM, GPS, RTC |

---

## **15. WEB TERMINAL - QUICK REFERENCE**

### **Essential Commands**
```bash
# View live sensor data
tail -f /var/log/varuna/sensor.log

# Check all services
systemctl status varuna-*

# Edit configuration
nano /etc/varuna/config.json

# Restart after changes
systemctl restart varuna

# Manual sensor test
python3 /opt/varuna/tools/read_sensors.py

# Check I2C devices
i2cdetect -y 1

# Test GSM module
python3 /opt/varuna/tools/gsm_test.py

# Force immediate transmission
varuna-cli force-transmit

# Update firmware from git
cd /opt/varuna && git pull && systemctl restart varuna

# Check system resources
htop

# View disk usage
df -h

# Check network
ping -c 3 api.cwc.gov.in
```

---

This feature list includes only the **4 defined operating modes** (Normal, Flood, Low Power, Maintenance) and adds the **Web Terminal Interface** feature for direct Linux command access and firmware modifications. üåä






















now the main objective is to build an embedded os  using qml  and c++; and connect the rpi along with its sensors to the website and display the data on it ; 
the embedded os run locally on the rpi 4 model b 4gb ram 

now with all of tht in mind :
## Development Phase Breakdown (Step-by-Step)

I need you to break this project into **incremental, bite-sized steps**. Each step adds only one small, testable feature. The goal is to build the entire UI incrementally without ever generating errors.

### Code Requirements

For each step, provide:

### Step Header Format:
```
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
PHASE X.STEP Y: [Feature Name]
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üìã STEP OBJECTIVE:
[Clear description of what this step adds]

üìÅ FILES IN THIS STEP:

üÜï NEW FILES TO CREATE:
   - path/to/newfile1.qml
   - path/to/newfile2.cpp
   - path/to/newfile2.h

üìù EXISTING FILES TO UPDATE:
   - path/to/existingfile1.qml (adding [specific feature])
   - path/to/existingfile2.cpp (adding [specific feature])

‚ö†Ô∏è IMPORTANT: Only create/modify files listed above in this step

üíª TERMINAL COMMANDS TO CREATE NEW FILES:
[Bash commands to create directories and empty files]

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
```

### Terminal Commands Format:
```bash
# Phase X.Step Y - File Creation Commands
# Run these commands from the project root directory (infotainment-os-V14/)

# Create directories (if needed)
mkdir -p qml/components
mkdir -p src
mkdir -p resources/icons

# Create empty files
touch qml/components/NewComponent.qml
touch src/newfile.cpp
touch src/newfile.h
```

> **Note on Icons:** The `resources/icons/` directory is reserved for my custom PNG assets. In QML, always reference icons using `source: "qrc:/icons/filename.png"`. Do **not** embed base64 or use placeholder rectangles‚Äîuse real `Image` components with valid paths so my PNGs will work when added later.



## STRICT CODING & EDITORIAL POLICY

> You are a precise code editor. Your job is to correct the **code only**, not change its logic or intended functionality.  
>
> Follow these strict rules:
>
> 1. ‚úÖ **Only fix code issues (if mentioned any)** ‚Äî do NOT modify or reinterpret the original logic.  
> 2. ‚ùå **Never call a function that is not defined** within the current code unless it is a known built-in.  
> 3. ‚ùå **Do not reference undefined variables** ‚Äî always ensure every variable is declared and initialized before use.  
> 4. ‚ùå **Avoid magic values or unexplained constants** ‚Äî define them with meaningful names if necessary.  
> 5. ‚ùå **Do not import unused modules** ‚Äî only include necessary imports.  
> 6. ‚ùå **Don‚Äôt create inconsistent indentation** ‚Äî follow a consistent 4-space indent (or as per original).  
> 7. ‚ùå **Do not mismatch variable types** ‚Äî e.g., don‚Äôt pass strings to numeric functions.  
> 8. ‚ùå **Never include placeholder comments like `// implement this` unless specifically asked.**  
> 9. ‚ùå **Do not skip error handling** ‚Äî use basic try/except or validations where needed.  
> 10. ‚ùå **Do not use variables before assigning values**, even if it seems obvious.  
> 11. ‚ùå **Avoid hardcoding file paths or settings** ‚Äî use variables or parameters instead.  
> 12. ‚ùå **Do not use outdated or deprecated syntax** ‚Äî follow modern Qt 6 and C++17/20 standards.  
> 13. ‚ùå **Do not leave code blocks incomplete** ‚Äî e.g., empty loops, empty functions, or unclosed structures.  
> 14. ‚úÖ **If you‚Äôre unsure about something, comment it clearly** without assuming the functionality.  
> 15. ‚úÖ **Your task is to ensure the code is logically unchanged but syntactically and structurally clean, correct, and ready to run.**

---

## CRITICAL FORMATTING & SAFETY RULES

‚ö†Ô∏è **ABSOLUTE REQUIREMENTS ‚Äì MUST FOLLOW:**

1. **ALL code must be inside code blocks** ‚Äì Use ```cpp, ```qml, ```bash, ```cmake formatting.  
2. **NEVER write code outside code blocks** ‚Äì No inline code snippets in explanations.  
3. **NEVER use "..." or truncation** ‚Äì Every file must be complete from start to finish.  
4. **ALWAYS include terminal commands** ‚Äì Show exact bash commands to create files/directories.  
5. **ALWAYS add file location comments** ‚Äì At top and bottom of every code file.  
6. **STRICT FILE OUTPUT RULE:** If you are adding more code to an existing file, you must print the **ENTIRE file from start to end**. If a file is not being modified in the current step, **do not print it at all**.  
7. **NO FEATURE REGRESSION RULE:** You **must never remove, disable, or comment out** any feature, component, or logic that was added in a previous step. Every new step must **build upon and preserve** all prior functionality.  
8. **STRICT NO-CODING-ERRORS RULE:** You must **absolutely ensure** that the code you provide is syntactically correct and will compile/run without any errors. **Before generating any code, you must mentally execute it line by line** to verify correctness. **If there is any possibility of an error, you must not provide the code and instead ask for clarification.** You are not allowed to provide code that contains syntax errors, type mismatches, undefined functions/variables, missing imports, or any other kind of error that would prevent successful compilation or execution. **Every step must produce a working, executable application with zero runtime crashes.** This rule supersedes all others.

---
